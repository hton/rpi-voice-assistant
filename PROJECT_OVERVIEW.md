# Обзор проекта - Голосовой Ассистент для Raspberry Pi

## Описание

Полнофункциональный голосовой ассистент на русском языке для Raspberry Pi 4 с локальной обработкой всех данных, интеграцией LLM моделей от HuggingFace, управлением умным домом и системой напоминаний.

## Ключевые особенности

### 🎯 Основной функционал
- **Офлайн работа** - все компоненты работают локально
- **Русский язык** - полная поддержка русского языка (STT, TTS, LLM)
- **Модульная архитектура** - легко расширяемая система
- **Гибкая конфигурация** - все настройки в YAML файле

### 🤖 Искусственный интеллект
- **LLM интеграция** через HuggingFace Transformers
- **4-bit квантизация** для работы на ограниченных ресурсах
- **Контекст разговора** - помнит предыдущие сообщения
- **Поддержка русских моделей** (Saiga, ruGPT-3, и др.)

### 🎤 Голосовые возможности
- **STT**: Vosk - точное распознавание русской речи
- **TTS**: Piper - качественный синтез русской речи
- **Двойная активация**: кнопка GPIO или голосовое ключевое слово
- **LED индикация** состояния системы

### 🏠 Умный дом
- **GPIO контроль** - прямое управление устройствами
- **MQTT поддержка** - интеграция с существующими системами
- **Голосовые команды** - естественное управление устройствами

### 📅 Организация
- **Локальные напоминания** с SQLite базой данных
- **Google Calendar** интеграция
- **Умный парсинг** времени из голосовых команд
- **Фоновая проверка** напоминаний

### 🌐 Информационные сервисы
- **Погода** через OpenWeatherMap API
- **Новости** через NewsAPI
- **Расширяемость** - легко добавить новые сервисы

## Архитектура проекта

```
rpi-voice-assistant/
│
├── config/                          # Конфигурация
│   ├── config.yaml                  # Основные настройки
│   └── google_credentials.json      # Google OAuth (создается пользователем)
│
├── models/                          # Модели ML
│   ├── vosk-model-small-ru-0.22/   # Vosk STT модель
│   └── piper/                       # Piper TTS модель
│       ├── ru_RU-ruslan-medium.onnx
│       └── ru_RU-ruslan-medium.onnx.json
│
├── src/                            # Исходный код
│   ├── assistant.py                # Главный файл приложения
│   │
│   ├── modules/                    # Основные модули
│   │   ├── stt.py                  # Speech-to-Text (Vosk)
│   │   ├── tts.py                  # Text-to-Speech (Piper)
│   │   ├── llm.py                  # LLM движок (Transformers)
│   │   └── activation.py           # Система активации (GPIO/wake word)
│   │
│   └── services/                   # Сервисы
│       ├── smart_home.py           # Умный дом (GPIO/MQTT)
│       ├── information.py          # Погода и новости
│       └── reminders.py            # Напоминания и календарь
│
├── logs/                           # Логи приложения
│
├── tests/                          # Тесты (для будущего расширения)
│
├── requirements.txt                # Python зависимости
├── .env.example                    # Шаблон переменных окружения
├── install.sh                      # Скрипт автоматической установки
├── test_components.py              # Тест всех компонентов
├── voice-assistant.service         # systemd service для автозапуска
│
├── README.md                       # Полная документация
├── QUICKSTART.md                   # Быстрый старт
└── PROJECT_OVERVIEW.md             # Этот файл
```

## Технологический стек

### Основной
- **Python 3.8+** - основной язык программирования
- **PyTorch** - фреймворк для ML моделей
- **HuggingFace Transformers** - библиотека для работы с LLM
- **Vosk** - распознавание речи
- **Piper TTS** - синтез речи

### Аппаратное взаимодействие
- **RPi.GPIO** - управление GPIO пинами
- **sounddevice** - работа с аудио устройствами
- **pyaudio** - низкоуровневая работа с аудио

### Интеграции
- **paho-mqtt** - MQTT клиент для умного дома
- **google-api-python-client** - Google Calendar API
- **requests** - HTTP запросы для API погоды и новостей

### Хранение данных
- **SQLite3** - база данных для напоминаний
- **PyYAML** - конфигурационные файлы
- **python-dotenv** - переменные окружения

## Основные компоненты

### 1. Модуль STT (src/modules/stt.py)
**Класс**: `SpeechRecognizer`

**Функции**:
- Распознавание речи с микрофона
- Определение тишины для автоматической остановки записи
- Прослушивание ключевых слов (wake word)
- Поддержка различных аудио устройств

**Зависимости**: Vosk, sounddevice

### 2. Модуль TTS (src/modules/tts.py)
**Классы**: `TextToSpeech`, `SimpleTTS`

**Функции**:
- Синтез русской речи высокого качества
- Настройка скорости и тона
- Фолбэк на espeak при недоступности Piper
- Воспроизведение через выбранное аудио устройство

**Зависимости**: Piper, sounddevice, espeak (резервный)

### 3. Модуль LLM (src/modules/llm.py)
**Классы**: `LLMEngine`, `SimpleLLM`

**Функции**:
- Загрузка и инференс LLM моделей
- 4-bit/8-bit квантизация для экономии памяти
- Управление контекстом разговора
- Настройка параметров генерации
- Фолбэк на rule-based систему

**Зависимости**: transformers, torch, bitsandbytes

### 4. Модуль активации (src/modules/activation.py)
**Класс**: `ActivationManager`

**Функции**:
- Обработка нажатия кнопки GPIO
- Детекция ключевых слов (wake word)
- LED индикация состояния
- Комбинированный режим активации

**Зависимости**: RPi.GPIO

### 5. Сервис умного дома (src/services/smart_home.py)
**Класс**: `SmartHomeController`

**Функции**:
- Прямое управление GPIO устройствами
- MQTT публикация/подписка
- Парсинг голосовых команд управления
- Отслеживание состояния устройств

**Зависимости**: RPi.GPIO, paho-mqtt

### 6. Информационные сервисы (src/services/information.py)
**Классы**: `WeatherService`, `NewsService`

**Функции**:
- Получение данных о погоде
- Получение последних новостей
- Форматирование для голосового вывода

**Зависимости**: requests

### 7. Сервис напоминаний (src/services/reminders.py)
**Классы**: `RemindersManager`, `GoogleCalendarService`

**Функции**:
- Создание и хранение напоминаний
- Парсинг времени из естественного языка
- Интеграция с Google Calendar
- Фоновая проверка активных напоминаний

**Зависимости**: sqlite3, google-api-python-client

### 8. Главное приложение (src/assistant.py)
**Класс**: `VoiceAssistant`

**Функции**:
- Инициализация всех компонентов
- Основной цикл работы
- Маршрутизация команд
- Управление логированием
- Graceful shutdown

## Процесс работы

```
┌─────────────────────────────────────────────────────────────┐
│                    Raspberry Pi Voice Assistant              │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │   Ожидание       │
                    │   активации      │
                    └──────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
           ┌────────▼────────┐  ┌──────▼──────┐
           │  Кнопка GPIO    │  │  Wake Word  │
           └────────┬────────┘  └──────┬──────┘
                    │                   │
                    └─────────┬─────────┘
                              ▼
                    ┌──────────────────┐
                    │  LED: слушаю     │
                    │  TTS: "Слушаю"   │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │   Распознавание  │
                    │   речи (Vosk)    │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Анализ команды  │
                    └──────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
   ┌────▼────┐          ┌────▼────┐          ┌────▼────┐
   │ Погода  │          │ Умный   │          │  LLM    │
   │ Новости │          │ дом     │          │ диалог  │
   │ и т.д.  │          │ MQTT    │          │         │
   └────┬────┘          └────┬────┘          └────┬────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              ▼
                    ┌──────────────────┐
                    │  Генерация       │
                    │  ответа          │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Синтез речи     │
                    │  (Piper)         │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  LED: готов      │
                    │  Возврат к       │
                    │  ожиданию        │
                    └──────────────────┘
```

## Конфигурация

Все настройки находятся в `config/config.yaml`:

```yaml
# Основные секции:
audio:          # Настройки аудио устройств
stt:            # Параметры распознавания речи
tts:            # Параметры синтеза речи
llm:            # Настройки языковой модели
wake_word:      # Ключевые слова активации
gpio:           # GPIO пины и устройства
smart_home:     # Умный дом (GPIO/MQTT)
google_calendar: # Интеграция Google Calendar
reminders:      # Система напоминаний
weather:        # API погоды
news:           # API новостей
logging:        # Настройки логирования
performance:    # Производительность
```

## Требования к ресурсам

### Минимальные (базовая работа)
- **Raspberry Pi 4** 4GB RAM
- **Модель**: `ai-forever/rugpt3large_based_on_gpt2` (1.5GB)
- **Квантизация**: отключена
- **SD карта**: 8GB

### Рекомендуемые (полный функционал)
- **Raspberry Pi 4** 8GB RAM
- **Модель**: `IlyaGusev/saiga_mistral_7b` (7B параметров)
- **Квантизация**: 4-bit
- **SD карта**: 16GB+
- **Охлаждение**: активное

### Производительность
- **Время загрузки модели**: 30-60 секунд
- **Время ответа LLM**: 5-15 секунд (зависит от модели)
- **Распознавание речи**: реальное время
- **Синтез речи**: <1 секунда

## API Ключи и интеграции

| Сервис | Необходимость | Стоимость | Лимиты |
|--------|--------------|-----------|--------|
| OpenWeatherMap | Опционально | Бесплатно | 1000 req/день |
| NewsAPI | Опционально | Бесплатно | 100 req/день |
| Google Calendar | Опционально | Бесплатно | Без лимитов |
| Porcupine Wake Word | Опционально | Бесплатно | Ограничено |

## Расширение функционала

### Добавление новой команды
```python
# В src/assistant.py, метод _process_command()
if 'моя команда' in text_lower:
    # Ваша логика
    self.tts.speak("Команда выполнена")
    return
```

### Добавление нового устройства
```yaml
# В config/config.yaml
smart_home:
  gpio_devices:
    - name: "новое устройство"
      pin: 25
      type: "switch"
```

### Добавление нового сервиса
1. Создайте файл в `src/services/`
2. Инициализируйте в `VoiceAssistant.__init__()`
3. Добавьте обработку в `_process_command()`

## Безопасность

- ✅ Все данные обрабатываются локально
- ✅ LLM модель работает на устройстве
- ✅ API ключи в .env файле (не в git)
- ✅ Google OAuth через официальную библиотеку
- ⚠️ MQTT без шифрования (можно настроить TLS)

## Известные ограничения

1. **Производительность**: LLM генерация может быть медленной на RPi
2. **Память**: Большие модели требуют swap или 8GB RAM
3. **Температура**: Рекомендуется активное охлаждение
4. **Wake word**: Базовая реализация через Vosk (не Porcupine)
5. **MQTT**: Требует настройки брокера

## Будущие улучшения

- [ ] Веб-интерфейс для управления
- [ ] Поддержка нескольких языков
- [ ] Улучшенная система wake word (Porcupine/Snowboy)
- [ ] Голосовая биометрия (multi-user)
- [ ] Интеграция с Home Assistant
- [ ] Mobile app для управления
- [ ] Автоматическое обновление моделей
- [ ] Телеграм бот интеграция

## Лицензия

MIT License - свободное использование и модификация

## Контакты и поддержка

- **Issues**: GitHub Issues
- **Документация**: README.md, QUICKSTART.md
- **Примеры**: test_components.py

---

**Версия проекта**: 1.0.0
**Дата создания**: 2025-11-06
**Создано с помощью**: Claude Code (Anthropic)
